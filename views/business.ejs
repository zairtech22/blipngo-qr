<!doctype html>
<html>
  <head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <title><%= biz.name %> • Admin</title>
    <link rel="stylesheet" href="/public/css/style.css?v=<%= Date.now() %>"/>
    <style>
      .admin-subhead { color:#6b7280; font-size:12px; margin-top:-6px; }
      .platform-card { display:flex; flex-direction:column; gap:8px; }
      .platform-header { display:flex; align-items:center; justify-content:space-between; }
      .platform-title { font-weight:600; }
      .qr { background:#fff; padding:10px; border-radius:12px; border:1px dashed #e5e7eb; display:flex; justify-content:center; }
      .qr img { max-width:150px; height:auto; border-radius:12px; }
      .platform-actions { display:flex; flex-direction:column; gap:8px; margin-top:4px; }
      .hint { color:#6b7280; font-size:12px; }
      .kv { font-size:12px; color:#6b7280; }
      @media (max-width: 980px) { .grid-3 { grid-template-columns: repeat(2, minmax(0,1fr)); } }
      @media (max-width: 680px) { .grid-3 { grid-template-columns: 1fr; } }
      .disabled-note { color:#b45309; font-size:12px; margin-top:-4px; }
      .layout-row .qr { justify-content:flex-start; }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <div>
          <h1><%= biz.name %> — Admin</h1>
          <div class="admin-subhead">Set brand theme, weekly links, and QR layout. QRs are dynamic & permanent.</div>
        </div>
        <div style="display:flex; gap:8px; align-items:center;">
          <form method="post" action="/business/<%= biz.slug %>/regen">
            <button type="submit" class="secondary">Regenerate QRs</button>
          </form>
          <a class="small" href="/">← Back</a>
        </div>
      </div>

      <div class="card">
        <div class="row">
          <div>
            <label>Slug</label>
            <div><code><%= biz.slug %></code></div>
          </div>
          <div>
            <label>Public printable page</label>
            <div><a href="/p/<%= biz.slug %>" target="_blank">/p/<%= biz.slug %></a></div>
          </div>
        </div>
        <div style="margin-top:12px; display:flex; justify-content:flex-end; gap:8px;">
          <form method="post" action="/business/<%= biz.slug %>/delete" onsubmit="return confirm('Delete this business and all data? This cannot be undone.')">
            <button type="submit" style="background:#b91c1c;">Delete Business</button>
          </form>
        </div>
      </div>

      <div class="card" style="margin-top:16px;">
        <h2>Theme, CTA & Layout</h2>
        <form method="post" action="/business/<%= biz.slug %>/theme">
          <div class="row">
            <div>
              <label>Accent Color</label>
              <input type="color" name="themeHex" value="<%= biz.themeHex || '#111827' %>"/>
            </div>
            <div>
              <label>Show Logo</label>
              <input type="checkbox" name="showLogo" <%= biz.showLogo ? 'checked' : '' %> />
            </div>
          </div>
          <div class="row">
            <div>
              <label>Background Gradient Start</label>
              <input type="color" name="themeBgHex" value="<%= biz.themeBgHex || '#0ea5e9' %>"/>
            </div>
            <div>
              <label>Background Gradient End</label>
              <input type="color" name="themeBgHex2" value="<%= biz.themeBgHex2 || '#6366f1' %>"/>
            </div>
          </div>
          <div class="row">
            <div>
              <label>Public Title</label>
              <input type="text" name="publicTitle" value="<%= biz.publicTitle || 'Scan to See Our Latest Posts' %>"/>
            </div>
            <div>
              <label>Public Subtitle / CTA (shown under logo)</label>
              <input type="text" name="publicSubtitle" value="<%= biz.publicSubtitle || 'Comment or share to get a discount!' %>"/>
            </div>
          </div>
          <div class="row">
            <div>
              <label>Footer Text</label>
              <input type="text" name="publicFooter" value="<%= biz.publicFooter || 'Thanks for supporting us!' %>"/>
            </div>
            <div>
              <label>QR Layout</label>
              <select name="qrLayout">
                <option value="vertical" <%= (biz.qrLayout || 'vertical') === 'vertical' ? 'selected' : '' %>>Vertical (stacked)</option>
                <option value="horizontal" <%= (biz.qrLayout || 'vertical') === 'horizontal' ? 'selected' : '' %>>Horizontal (side‑by‑side)</option>
              </select>
            </div>
          </div>
          <div style="text-align:right; margin-top:8px;"><button type="submit">Save Theme</button></div>
        </form>
      </div>

      <div class="grid grid-3" style="margin-top:16px;">
        <!-- Instagram -->
        <div class="card platform-card">
          <div class="platform-header">
            <div class="platform-title">Instagram</div>
            <div class="kv">Scan URL: <code>/r/<%= biz.slug %>/instagram</code></div>
          </div>
          <div class="qr">
            <img src="/qr/<%= biz.slug %>/instagram.png" alt="Instagram QR"/>
          </div>
          <% if (!biz.instagramUrl) { %>
            <div class="disabled-note">Currently disabled — scans fall back to the public page.</div>
          <% } %>
          <div class="platform-actions">
            <form method="post" action="/business/<%= biz.slug %>/update">
              <input type="hidden" name="platform" value="instagram"/>
              <label class="small">Target URL</label>
              <input type="url" name="newUrl" value="<%= biz.instagramUrl || '' %>" placeholder="https://www.instagram.com/p/...">
              <div style="text-align:right; margin-top:6px;"><button type="submit">Update URL</button></div>
            </form>
            <form method="post" action="/business/<%= biz.slug %>/toggle" style="border-top:1px solid #e5e7eb; padding-top:8px;">
              <input type="hidden" name="platform" value="instagram"/>
              <label class="small">Enabled</label>
              <input type="checkbox" name="enabled" <%= biz.instagramUrl ? 'checked' : '' %> onchange="this.form.submit()" />
              <div class="hint">Toggle only affects the target URL; the QR stays the same.</div>
            </form>
          </div>
        </div>

        <!-- TikTok -->
        <div class="card platform-card">
          <div class="platform-header">
            <div class="platform-title">TikTok</div>
            <div class="kv">Scan URL: <code>/r/<%= biz.slug %>/tiktok</code></div>
          </div>
          <div class="qr">
            <img src="/qr/<%= biz.slug %>/tiktok.png" alt="TikTok QR"/>
          </div>
          <% if (!biz.tiktokUrl) { %>
            <div class="disabled-note">Currently disabled — scans fall back to the public page.</div>
          <% } %>
          <div class="platform-actions">
            <form method="post" action="/business/<%= biz.slug %>/update">
              <input type="hidden" name="platform" value="tiktok"/>
              <label class="small">Target URL</label>
              <input type="url" name="newUrl" value="<%= biz.tiktokUrl || '' %>" placeholder="https://www.tiktok.com/...">
              <div style="text-align:right; margin-top:6px;"><button type="submit">Update URL</button></div>
            </form>
            <form method="post" action="/business/<%= biz.slug %>/toggle" style="border-top:1px solid #e5e7eb; padding-top:8px;">
              <input type="hidden" name="platform" value="tiktok"/>
              <label class="small">Enabled</label>
              <input type="checkbox" name="enabled" <%= biz.tiktokUrl ? 'checked' : '' %> onchange="this.form.submit()" />
              <div class="hint">Toggle only affects the target URL; the QR stays the same.</div>
            </form>
          </div>
        </div>

        <!-- YouTube -->
        <div class="card platform-card">
          <div class="platform-header">
            <div class="platform-title">YouTube</div>
            <div class="kv">Scan URL: <code>/r/<%= biz.slug %>/youtube</code></div>
          </div>
          <div class="qr">
            <img src="/qr/<%= biz.slug %>/youtube.png" alt="YouTube QR"/>
          </div>
          <% if (!biz.youtubeUrl) { %>
            <div class="disabled-note">Currently disabled — scans fall back to the public page.</div>
          <% } %>
          <div class="platform-actions">
            <form method="post" action="/business/<%= biz.slug %>/update">
              <input type="hidden" name="platform" value="youtube"/>
              <label class="small">Target URL</label>
              <input type="url" name="newUrl" value="<%= biz.youtubeUrl || '' %>" placeholder="https://www.youtube.com/watch?v=...">
              <div style="text-align:right; margin-top:6px;"><button type="submit">Update URL</button></div>
            </form>
            <form method="post" action="/business/<%= biz.slug %>/toggle" style="border-top:1px solid #e5e7eb; padding-top:8px;">
              <input type="hidden" name="platform" value="youtube"/>
              <label class="small">Enabled</label>
              <input type="checkbox" name="enabled" <%= biz.youtubeUrl ? 'checked' : '' %> onchange="this.form.submit()" />
              <div class="hint">Toggle only affects the target URL; the QR stays the same.</div>
            </form>
          </div>
        </div>
      </div>

      <div class="card" style="margin-top:16px;">
        <h2>API Endpoints</h2>
        <ul class="small">
          <li>Scan redirect: <code>/r/:slug/:platform</code></li>
          <li>Printable page: <code>/p/:slug</code></li>
          <li>QR image (dynamic): <code>/qr/:slug/:platform.png</code></li>
          <li>Analytics (JSON): <code>/business/:slug/analytics.json</code></li>
        </ul>
      </div>
    </div>
  </body>
</html>
