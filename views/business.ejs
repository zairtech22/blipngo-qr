<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title><%= biz.name %> — Admin</title>
  <style>
    :root{
      --ink:#0A0A0A; --muted:#6b7280; --bg:#fafafa; --card:#ffffff; --accent:#FFD21E;
    }
    html,body{margin:0;padding:0;background:var(--bg);color:var(--ink);font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;}
    .wrap{max-width:1000px;margin:24px auto;padding:0 16px;}
    header{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:16px;}
    .title{display:flex;align-items:center;gap:12px;flex-wrap:wrap}
    .logo{width:56px;height:56px;border-radius:12px;border:2px solid #111;background:#fff;display:grid;place-items:center;overflow:hidden}
    .logo img{width:100%;height:100%;object-fit:contain}
    h1{margin:0;font-size:28px}
    .actions{display:flex;gap:10px;flex-wrap:wrap}
    .btn{display:inline-block;padding:8px 14px;border-radius:8px;border:2px solid #111;text-decoration:none;font-weight:700;background:#fff;color:#111}
    .btn:hover{background:#111;color:#fff}
    .btn-primary{background:var(--accent)}
    .btn-danger{border-color:#b91c1c;color:#b91c1c}
    .btn-danger:hover{background:#b91c1c;color:#fff}
    .grid{display:grid;gap:16px}
    @media(min-width:900px){.grid{grid-template-columns:1.2fr .8fr}}
    .card{background:var(--card);border:1px solid #e5e7eb;border-radius:12px;padding:16px}
    .card h2{margin:0 0 10px 0;font-size:18px}
    label{display:block;font-weight:700;margin:10px 0 6px}
    input[type="text"], input[type="url"], input[type="color"], textarea, select{
      width:100%;padding:10px;border:1px solid #d1d5db;border-radius:8px;font-size:14px;box-sizing:border-box;background:#fff
    }
    textarea{min-height:110px}
    .row{display:grid;gap:10px;grid-template-columns:1fr 1fr}
    .muted{color:var(--muted);font-size:13px}
    .pill{display:inline-block;border:2px solid #111;border-radius:999px;padding:4px 10px;font-weight:800;background:#fff}
    .platforms{display:grid;gap:12px}
    .plat{display:grid;grid-template-columns:130px 1fr;gap:10px;align-items:center}
    .hr{height:1px;background:#e5e7eb;margin:12px 0}
    .qr-preview{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
    .qr-preview img{width:96px;height:96px;border:1px solid #e5e7eb;border-radius:8px;background:#fff;object-fit:cover}
    .danger-zone{border:1px dashed #ef4444;background:#fff7f7}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="title">
        <div class="logo">
          <% if (biz.showLogo && biz.logoUrl) { %>
            <img src="<%= biz.logoUrl %>" alt="<%= biz.name %> logo" />
          <% } else { %>
            <strong><%= (biz.name || 'Logo').split(' ').slice(0,2).map(s=>s[0]).join('') %></strong>
          <% } %>
        </div>
        <div>
          <h1><%= biz.name %></h1>
          <div class="muted">Slug: <span class="pill"><%= biz.slug %></span></div>
        </div>
      </div>

      <div class="actions">
        <!-- 🖨 Print Poster button -->
        <a class="btn btn-primary" target="_blank" href="/poster/<%= biz.slug %>">🖨 Print Poster</a>
        <a class="btn" target="_blank" href="/p/<%= biz.slug %>">👀 Public Page</a>
      </div>
    </header>

    <div class="grid">
      <!-- THEME / CTA / STEPS -->
      <section class="card">
        <h2>Theme & Content</h2>
        <form method="POST" action="/business/<%= biz.slug %>/theme">
          <div class="row">
            <div>
              <label for="brandColor">Brand color</label>
              <input id="brandColor" name="brandColor" type="text" placeholder="#FFD21E" value="<%= biz.brandColor || '' %>">
              <div class="muted">Hex or CSS color. Used as poster background.</div>
            </div>
            <div>
              <label for="showLogo">Show logo?</label>
              <select id="showLogo" name="showLogo">
                <option value="" <%= !biz.showLogo ? 'selected' : '' %>>No</option>
                <option value="on" <%= biz.showLogo ? 'selected' : '' %>>Yes</option>
              </select>
              <div class="muted">Logo URL below controls the image.</div>
            </div>
          </div>

          <label for="logoUrl">Logo URL</label>
          <input id="logoUrl" name="logoUrl" type="url" value="<%= biz.logoUrl || '' %>" placeholder="https://.../logo.png">

          <div class="row">
            <div>
              <label for="publicTitle">Public title</label>
              <input id="publicTitle" name="publicTitle" type="text" value="<%= biz.publicTitle || '' %>">
            </div>
            <div>
              <label for="ctaText">CTA text</label>
              <input id="ctaText" name="ctaText" type="text" value="<%= biz.ctaText || '' %>" placeholder="Every Scan Wins — Some Unlock a Golden Ticket 🎟️">
            </div>
          </div>

          <label for="publicSubtitle">Public subtitle</label>
          <input id="publicSubtitle" name="publicSubtitle" type="text" value="<%= biz.publicSubtitle || '' %>" placeholder="(Optional)">

          <label for="publicFooter">Public footer</label>
          <input id="publicFooter" name="publicFooter" type="text" value="<%= biz.publicFooter || '' %>" placeholder="Perks tied to follows/check-ins. Feedback appreciated, never required.">

          <div class="row">
            <div>
              <label for="ctaLabel">CTA label (admin use)</label>
              <input id="ctaLabel" name="ctaLabel" type="text" value="<%= biz.ctaLabel || '' %>">
            </div>
            <div>
              <label for="qrLayout">QR layout</label>
              <select id="qrLayout" name="qrLayout">
                <option value="vertical" <%= biz.qrLayout !== 'horizontal' ? 'selected' : '' %>>Vertical</option>
                <option value="horizontal" <%= biz.qrLayout === 'horizontal' ? 'selected' : '' %>>Horizontal</option>
              </select>
            </div>
          </div>

          <label for="steps">Steps (one per line)</label>
          <textarea id="steps" name="steps" placeholder="1) Scan any QR below and open the app.&#10;2) Follow us and say hi in a comment or DM.&#10;3) Optional: Share feedback on Google — totally up to you.&#10;4) Show the screen at the counter to redeem your perk."><%= (biz.steps || []).sort((a,b)=>a.order-b.order).map(s=>s.text).join('\n') %></textarea>

          <div style="margin-top:12px;display:flex;gap:10px;align-items:center">
            <button class="btn btn-primary" type="submit">💾 Save Theme & Steps</button>
            <span class="muted">Updates reflect on public page and poster.</span>
          </div>
        </form>
      </section>

      <!-- SOCIAL / QR CONTROL -->
      <section class="card">
        <h2>Social Links & QR</h2>

        <div class="platforms">
          <!-- TikTok -->
          <div class="plat">
            <div><strong>🎵 TikTok</strong></div>
            <div>
              <form method="POST" action="/business/<%= biz.slug %>/update" style="margin-bottom:8px">
                <input type="hidden" name="platform" value="tiktok">
                <label>URL</label>
                <input type="url" name="newUrl" placeholder="https://www.tiktok.com/@yourhandle" value="<%= biz.tiktokUrl || '' %>">
                <div style="margin-top:8px;display:flex;gap:8px;">
                  <button class="btn btn-primary" type="submit">Update</button>
                </div>
              </form>

              <form method="POST" action="/business/<%= biz.slug %>/toggle">
                <input type="hidden" name="platform" value="tiktok">
                <label>Enable / Disable</label>
                <div style="display:flex;gap:8px;align-items:center">
                  <select name="enabled">
                    <option value="on" <%= biz.tiktokUrl ? 'selected' : '' %>>Enabled</option>
                    <option value="">Disabled</option>
                  </select>
                  <input type="url" name="newUrl" placeholder="(Optional) set while enabling">
                  <button class="btn" type="submit">Apply</button>
                </div>
              </form>

              <div class="qr-preview">
                <img src="/qr/<%= biz.slug %>/tiktok.png" alt="TikTok QR" />
              </div>
            </div>
          </div>

          <div class="hr"></div>

          <!-- Instagram -->
          <div class="plat">
            <div><strong>📸 Instagram</strong></div>
            <div>
              <form method="POST" action="/business/<%= biz.slug %>/update" style="margin-bottom:8px">
                <input type="hidden" name="platform" value="instagram">
                <label>URL</label>
                <input type="url" name="newUrl" placeholder="https://www.instagram.com/yourhandle" value="<%= biz.instagramUrl || '' %>">
                <div style="margin-top:8px;display:flex;gap:8px;">
                  <button class="btn btn-primary" type="submit">Update</button>
                </div>
              </form>

              <form method="POST" action="/business/<%= biz.slug %>/toggle">
                <input type="hidden" name="platform" value="instagram">
                <label>Enable / Disable</label>
                <div style="display:flex;gap:8px;align-items:center">
                  <select name="enabled">
                    <option value="on" <%= biz.instagramUrl ? 'selected' : '' %>>Enabled</option>
                    <option value="">Disabled</option>
                  </select>
                  <input type="url" name="newUrl" placeholder="(Optional) set while enabling">
                  <button class="btn" type="submit">Apply</button>
                </div>
              </form>

              <div class="qr-preview">
                <img src="/qr/<%= biz.slug %>/instagram.png" alt="Instagram QR" />
              </div>
            </div>
          </div>

          <div class="hr"></div>

          <!-- YouTube -->
          <div class="plat">
            <div><strong>▶ YouTube</strong></div>
            <div>
              <form method="POST" action="/business/<%= biz.slug %>/update" style="margin-bottom:8px">
                <input type="hidden" name="platform" value="youtube">
                <label>URL</label>
                <input type="url" name="newUrl" placeholder="https://www.youtube.com/@yourchannel/shorts" value="<%= biz.youtubeUrl || '' %>">
                <div style="margin-top:8px;display:flex;gap:8px;">
                  <button class="btn btn-primary" type="submit">Update</button>
                </div>
              </form>

              <form method="POST" action="/business/<%= biz.slug %>/toggle">
                <input type="hidden" name="platform" value="youtube">
                <label>Enable / Disable</label>
                <div style="display:flex;gap:8px;align-items:center">
                  <select name="enabled">
                    <option value="on" <%= biz.youtubeUrl ? 'selected' : '' %>>Enabled</option>
                    <option value="">Disabled</option>
                  </select>
                  <input type="url" name="newUrl" placeholder="(Optional) set while enabling">
                  <button class="btn" type="submit">Apply</button>
                </div>
              </form>

              <div class="qr-preview">
                <img src="/qr/<%= biz.slug %>/youtube.png" alt="YouTube QR" />
              </div>
            </div>
          </div>
        </div>
      </section>
    </div>

    <!-- Analytics + Danger Zone -->
    <section class="card" style="margin-top:16px;">
      <h2>Analytics</h2>
      <p class="muted">Raw counts JSON: <a href="/business/<%= biz.slug %>/analytics.json" target="_blank">/business/<%= biz.slug %>/analytics.json</a></p>
    </section>

    <section class="card danger-zone" style="margin-top:16px;">
      <h2>Danger Zone</h2>
      <form method="POST" action="/business/<%= biz.slug %>/delete" onsubmit="return confirm('Delete this business and all related data?');">
        <button class="btn btn-danger" type="submit">🗑 Delete Business</button>
      </form>
    </section>
  </div>
</body>
</html>
