<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title><%= biz.publicTitle || (biz.name + ' ‚Äî Poster') %></title>

  <style>
    :root{
      --bg: <%= biz.brandColor ? biz.brandColor : '#FFD21E' %>;
      --ink:#0A0A0A; --paper:#FFFBEA; --muted:#4a4a4a;
    }

    /* ---------- SCREEN LAYOUT ---------- */
    html,body{height:100%}
    body{
      margin:0;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;
      background:var(--bg); color:var(--ink);
      -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
    }
    .page{
      min-height:100vh; display:flex; justify-content:center; padding:16px;
    }
    .poster{
      width:100%; max-width:820px; margin:auto;
      background:var(--bg);
      border:6px solid var(--ink); border-radius:28px; box-sizing:border-box;
      box-shadow:0 10px 24px rgba(0,0,0,.15);
      padding:32px 28px;
    }

    .header{text-align:center; margin-bottom:14px}
    .logo{
      width:120px; height:120px; margin:0 auto 10px;
      background:var(--paper); border:4px solid var(--ink); border-radius:20px;
      display:grid; place-items:center; overflow:hidden;
    }
    .logo img{width:100%; height:100%; object-fit:contain}
    .bizname{margin:0; text-transform:uppercase; font-weight:900; font-size:clamp(20px,4.6vw,20px)}
    .cta{margin:10px 0 14px; text-transform:uppercase; font-weight:900; font-size:clamp(28px,3.4vw,44px); text-align:center}

    .steps{
      list-style:none; padding:0; margin:0 auto 18px; max-width:640px;
      font-size:clamp(15px,2.4vw,18px); font-weight:700; display:grid; gap:8px;
    }
    .steps li{display:grid; grid-template-columns:30px 1fr; align-items:center; gap:10px}
    .steps .num{
      width:30px; height:30px; border:3px solid var(--ink); background:var(--paper);
      border-radius:10px; display:grid; place-items:center; font-weight:900;
    }

    /* ---------- QR GRID (SCREEN) ----------
       We use a CSS var for card width and QR height, set by the count class. */
    .qr-grid{
      --card-w: 240px;     /* default for 3 cards */
      --qr-h:  220px;
      display:flex; flex-wrap:wrap; justify-content:center;
      gap:22px; margin-top:8px;
    }
    .qr-grid.qr-1{ --card-w: 360px; --qr-h:  320px; }
    .qr-grid.qr-2{ --card-w: 300px; --qr-h:  270px; }
    .qr-grid.qr-3{ --card-w: 240px; --qr-h:  220px; }

    .qr-card{
      background:var(--paper); border:4px solid var(--ink); border-radius:18px;
      padding:14px; width:var(--card-w); box-sizing:border-box; overflow:hidden;
      display:grid; gap:10px;
    }
    .qr-head{display:flex; align-items:center; justify-content:center; gap:8px; font-weight:900}
    .qr-ico{
      width:26px; height:26px; border:2px solid var(--ink); border-radius:8px; background:#fff;
      display:grid; place-items:center; font-size:13px; font-weight:900;
    }
    .qr-title{font-size:14px; text-transform:uppercase}

    .qr-img{
      width:100%; height:var(--qr-h); background:#fff;
      border:3px solid var(--ink); border-radius:12px;
      display:grid; place-items:center; overflow:hidden; box-sizing:border-box;
    }
    .qr-img img{
      width:94%; height:94%; object-fit:contain;
      image-rendering:pixelated; image-rendering:crisp-edges;
      max-width:94%; max-height:94%;
    }

    .fineprint{margin-top:14px; text-align:center; font-size:12px; color:var(--muted); font-weight:600}

    /* ---------- PRINT (A4/Letter) ----------
       Fixed dimensions with safe margins; hard caps per QR count. */
    @media print{
      @page{ margin: 0; }
      html,body{height:auto}
      body{ background:#fff !important; color:#000 !important; -webkit-print-color-adjust:exact; print-color-adjust:exact; }

      .poster{
        width:186mm; height:273mm;      /* fits A4 and Letter with margins */
        margin:12mm auto;
        padding:8mm;
        border-width:3px; box-sizing:border-box;
      }

      .logo{ width:30mm; height:30mm; border-width:2px; border-radius:6mm; margin-bottom:4mm }
      .bizname{ font-size:24pt; margin:0 0 2mm }
      .cta{ font-size:16.5pt; margin:2mm 0 4mm }
      .steps{ font-size:11.2pt; gap:3mm; margin:0 0 6mm }
      .steps .num{ width:18px; height:18px; border-width:2px; font-size:10pt }

      .qr-grid{
        gap:8mm; row-gap:8mm; justify-content:center; align-items:flex-start; flex-wrap:wrap;
      }
      /* per-count caps */
      .qr-grid.qr-1{ --card-w: 70mm; --qr-h: 54mm; }
      .qr-grid.qr-2{ --card-w: 60mm; --qr-h: 48mm; }
      .qr-grid.qr-3{ --card-w: 54mm; --qr-h: 42mm; }

      .qr-card{
        width:var(--card-w); padding:4.5mm; border-width:2px; border-radius:5mm;
      }
      .qr-head{ font-size:11pt }
      .qr-ico{ width:9mm; height:9mm; font-size:9pt; border-width:1.6px; border-radius:2.5mm }
      .qr-title{ font-size:10.5pt }

      .qr-img{
        height:var(--qr-h); border-width:2px; border-radius:3mm;
      }
      .qr-img img{
        max-width:92% !important; max-height:92% !important;
        width:auto; height:auto; object-fit:contain !important;
      }

      .fineprint{ font-size:9.5pt; margin-top:6mm }
    }
  </style>
</head>

<body>
  <div class="page">
    <main class="poster" id="poster">
      <div class="header">
        <div class="logo">
          <% if (biz.showLogo && biz.logoUrl) { %>
            <img src="<%= biz.logoUrl %>" alt="<%= biz.name %> logo" />
          <% } else { %>
            <div><%= (biz.name || 'Your Logo').split(' ').slice(0,2).join('<br>') %></div>
          <% } %>
        </div>
        <h1 class="bizname"><%= biz.name %></h1>
      </div>

      <h2 class="cta"><%= biz.ctaText || 'Every Scan Wins ‚Äî Some Unlock a Golden Ticket üéüÔ∏è' %></h2>

      <ol class="steps">
        <% if (biz.steps && biz.steps.length) {
             biz.steps.sort((a,b)=>a.order-b.order).forEach((s,i)=>{ %>
          <li><span class="num"><%= i+1 %></span><span><%= s.text %></span></li>
        <% }) } else { %>
          <li><span class="num">1</span><span>Scan a QR below to open our latest post.</span></li>
          <li><span class="num">2</span><span>Engage with us ‚Üí comment, share, or tag us.</span></li>
          <li><span class="num">3</span><span>Check your screen ‚Üí you‚Äôll always get our discount, and sometimes a Golden Ticket üéüÔ∏è!</span></li>
          <li><span class="num">4</span><span>Show your screen at the counter to redeem.</span></li>
        <% } %>
      </ol>

      <% /* Build the enabled platforms and count */ %>
      <%
        const cards = [];
        if (biz.tiktokUrl) cards.push('tiktok');
        if (biz.instagramUrl) cards.push('instagram');
        if (biz.youtubeUrl) cards.push('youtube');
        const qCount = cards.length || 0;
      %>

      <section class="qr-grid qr-<%= qCount %>">
        <% if (biz.tiktokUrl) { %>
          <article class="qr-card">
            <div class="qr-head"><div class="qr-ico">‚ô™</div><div class="qr-title">TIKTOK</div></div>
            <div class="qr-img"><img alt="TikTok QR" src="/qr/<%= biz.slug %>/tiktok.png" /></div>
          </article>
        <% } %>

        <% if (biz.instagramUrl) { %>
          <article class="qr-card">
            <div class="qr-head"><div class="qr-ico">IG</div><div class="qr-title">INSTAGRAM</div></div>
            <div class="qr-img"><img alt="Instagram QR" src="/qr/<%= biz.slug %>/instagram.png" /></div>
          </article>
        <% } %>

        <% if (biz.youtubeUrl) { %>
          <article class="qr-card">
            <div class="qr-head"><div class="qr-ico">‚ñ∂</div><div class="qr-title">YOUTUBE SHORTS</div></div>
            <div class="qr-img"><img alt="YouTube QR" src="/qr/<%= biz.slug %>/youtube.png" /></div>
          </article>
        <% } %>
      </section>

      <p class="fineprint">
        <%= (biz.publicFooter && biz.publicFooter.trim().length)
              ? biz.publicFooter
              : 'Perks tied to follows/check-ins. Feedback appreciated, never required.' %>
      </p>
    </main>
  </div>
</body>
</html>
