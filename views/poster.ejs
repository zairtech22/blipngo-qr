<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title><%= biz.publicTitle || (biz.name + ' — Poster') %></title>

  <style>
    :root{
      --bg: <%= biz.brandColor ? biz.brandColor : '#FFD21E' %>;
      --ink:#0A0A0A; --paper:#FFFBEA; --muted:#4a4a4a;
    }

    html,body{height:100%}
    body{
      margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;
      background:var(--bg); color:var(--ink);
      -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
    }

    /* Sheet sizes for preview */
    body.letter .page{width:8.5in; min-height:11in}
    body.a4     .page{width:210mm; min-height:297mm}

    /* Center sheet and poster */
    .page{
      margin:0 auto; min-height:100vh;
      display:flex; align-items:flex-start; justify-content:center; padding:16px;
    }

    /* Toolbar (hidden on public & print) */
    .toolbar{position:fixed; top:10px; right:10px; display:flex; gap:8px; z-index:10}
    .btn{background:#fff; color:#000; border:2px solid #000; border-radius:8px; padding:8px 12px; font-weight:700; cursor:pointer}
    .btn:hover{background:#000; color:#fff}

    /* Poster container */
    .poster{
      width:100%; max-width:820px; margin:0 auto; box-sizing:border-box;
      background:var(--bg);
      border:6px solid var(--ink); border-radius:28px;
      box-shadow:0 10px 24px rgba(0,0,0,.15);
      padding:32px 28px 28px;
    }

    /* Header */
    .header{text-align:center; margin:6px 0 10px}
    .logo{
      width:128px; height:128px; margin:0 auto 14px;
      background:var(--paper); border:4px solid var(--ink); border-radius:22px;
      display:grid; place-items:center; overflow:hidden; font-weight:800;
    }
    .logo img{width:100%; height:100%; object-fit:contain}
    .bizname{margin:0; text-align:center; text-transform:uppercase; font-weight:900; font-size:clamp(30px,4.8vw,44px); line-height:1.08}
    .cta{margin:10px 0 14px; text-align:center; text-transform:uppercase; font-weight:900; font-size:clamp(22px,3.6vw,30px); letter-spacing:.8px}

    /* Steps */
    .steps{list-style:none; padding:0; margin:6px auto 16px; max-width:640px; font-size:clamp(15px,2.5vw,18px); font-weight:700; display:grid; gap:8px}
    .steps li{display:grid; grid-template-columns:30px 1fr; align-items:center; gap:10px}
    .steps .num{width:30px; height:30px; border:3px solid var(--ink); background:var(--paper); border-radius:10px; display:grid; place-items:center; font-weight:900}

    /* QR grid (screen: 3 columns) */
    .qr-grid{
      display:grid; gap:22px; grid-template-columns:repeat(3,1fr); margin-top:6px
    }
    @media (max-width:820px){ .qr-grid{grid-template-columns:1fr} }

    .qr-card{
      background:var(--paper); border:4px solid var(--ink); border-radius:20px; padding:14px 14px 16px;
      display:grid; grid-template-rows:auto 1fr; gap:10px; box-shadow:inset 0 -6px rgba(0,0,0,.05);
      page-break-inside:avoid;
    }
    .qr-head{display:flex; align-items:center; justify-content:center; gap:10px; font-weight:900}
    .qr-ico{width:30px; height:30px; border:3px solid var(--ink); border-radius:10px; background:#fff; display:grid; place-items:center; font-size:16px}
    .qr-title{text-transform:uppercase; letter-spacing:.4px}

    /* QR image: crisp and contained */
    .qr-img{
      width:100%; aspect-ratio:1/1; border:3px solid var(--ink); border-radius:14px; background:#fff;
      display:grid; place-items:center; overflow:hidden;
    }
    .qr-img img{
      width:96%; height:96%;
      object-fit:contain;
      image-rendering:pixelated; image-rendering:crisp-edges;
    }

    .fineprint{margin-top:12px; text-align:center; font-size:12px; color:var(--muted); font-weight:600}

    /* ---------------- PRINT: fit page, wrap grid to 2 columns, never clip ---------------- */
    @media print{
  @page { margin: 0; }
  .toolbar{display:none !important}
  body{background:#fff !important; color:#000 !important}
  .page{padding:0 !important}

  /* Poster fit to sheet */
  body.a4 .poster{
    width: 190mm !important;
    height: 277mm !important;
    margin: 10mm auto !important;
    padding: 10mm !important;
    box-sizing: border-box !important;
  }
  body.letter .poster{
    width: 7.8in !important;
    height: 10.2in !important;
    margin: 0.3in auto !important;
    padding: 0.3in !important;
    box-sizing: border-box !important;
  }

  /* Keep 3 columns */
  .qr-grid{
    grid-template-columns: repeat(3, 1fr) !important;
    gap: 6mm !important;
  }

  /* Shrink card sizes to fit */
  .qr-card{
    padding: 5mm !important;
    border-width: 2px !important;
  }

  /* Adjust QR image size */
  body.a4 .qr-img{ height: 50mm !important; }
  body.letter .qr-img{ height: 2in !important; }
  .qr-img img{ width:95% !important; height:95% !important; }
}

  </style>
</head>

<body class="<%= isPublic ? 'a4' : (biz.pageSize === 'A4' ? 'a4' : 'letter') %>">
  <% if (!isPublic) { %>
    <!-- Admin toolbar -->
    <div class="toolbar">
      <button class="btn" onclick="setFormat('a4')">A4</button>
      <button class="btn" onclick="setFormat('letter')">Letter</button>
      <button class="btn" onclick="window.print()">Print</button>
    </div>
  <% } %>

  <div class="page">
    <main class="poster" id="poster">
      <div class="header">
        <div class="logo">
          <% if (biz.showLogo && biz.logoUrl) { %>
            <img src="<%= biz.logoUrl %>" alt="<%= biz.name %> logo" />
          <% } else { %>
            <div><%= (biz.name || 'Your Logo').split(' ').slice(0,2).join('<br>') %></div>
          <% } %>
        </div>
        <h1 class="bizname"><%= biz.name %></h1>
      </div>

      <h2 class="cta"><%= biz.ctaText || 'Every Scan Wins — Some Unlock a Golden Ticket 🎟️' %></h2>

      <ol class="steps">
        <% if (biz.steps && biz.steps.length) {
             biz.steps.sort(function(a,b){ return a.order - b.order; }).forEach(function(s,i){ %>
          <li><span class="num"><%= i+1 %></span><span><%= s.text %></span></li>
        <% }); } else { %>
          <li><span class="num">1</span><span>Scan a QR below to open our latest post.</span></li>
          <li><span class="num">2</span><span>Engage with us → comment, share, or upload a photo and tag us.</span></li>
          <li><span class="num">3</span><span>Check your screen → you’ll always get our 5% discount, and sometimes a Golden Ticket surprise!</span></li>
          <li><span class="num">4</span><span>Show your screen at the counter to redeem your perk.</span></li>
        <% } %>
      </ol>

      <section class="qr-grid">
        <% if (biz.tiktokUrl) { %>
          <article class="qr-card">
            <div class="qr-head"><div class="qr-ico">♪</div><div class="qr-title">TIKTOK</div></div>
            <div class="qr-img"><img alt="TikTok QR" src="/qr/<%= biz.slug %>/tiktok.png" /></div>
          </article>
        <% } %>
        <% if (biz.instagramUrl) { %>
          <article class="qr-card">
            <div class="qr-head"><div class="qr-ico">IG</div><div class="qr-title">INSTAGRAM</div></div>
            <div class="qr-img"><img alt="Instagram QR" src="/qr/<%= biz.slug %>/instagram.png" /></div>
          </article>
        <% } %>
        <% if (biz.youtubeUrl) { %>
          <article class="qr-card">
            <div class="qr-head"><div class="qr-ico">▶</div><div class="qr-title">YOUTUBE SHORTS</div></div>
            <div class="qr-img"><img alt="YouTube QR" src="/qr/<%= biz.slug %>/youtube.png" /></div>
          </article>
        <% } %>
      </section>

      <p class="fineprint">
        <%= (biz.publicFooter && biz.publicFooter.trim().length)
              ? biz.publicFooter
              : 'Perks tied to follows/check-ins. Feedback appreciated, never required.' %>
      </p>
    </main>
  </div>

  <% if (!isPublic) { %>
  <script>
    function setFormat(format){
      document.body.classList.remove('a4','letter');
      document.body.classList.add(format);
      sessionStorage.setItem('poster-format', format);
    }
    (function init(){
      const p = new URLSearchParams(location.search);
      const savedFormat = sessionStorage.getItem('poster-format');
      if (p.get('size') === 'a4') setFormat('a4');
      else if (p.get('size') === 'letter') setFormat('letter');
      else if (savedFormat) setFormat(savedFormat);
      else if (!document.body.classList.contains('a4') && !document.body.classList.contains('letter')) {
        document.body.classList.add('<%= biz.pageSize === "A4" ? "a4" : "letter" %>');
      }
    })();
  </script>
  <% } %>
</body>
</html>
