datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model Business {
  id             String   @id @default(cuid())
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  name           String
  slug           String   @unique
  logoUrl        String?

  // Theming / public texts
  themeHex       String?
  themeBgHex     String?
  themeBgHex2    String?
  publicTitle    String?
  publicSubtitle String?
  publicFooter   String?
  ctaLabel       String?
  showLogo       Boolean  @default(true)

  // Weekly target URLs per platform (null = disabled)
  instagramUrl   String?
  tiktokUrl      String?
  youtubeUrl     String?

  // Layout for public page: "vertical" | "horizontal"
  qrLayout       String?  // store 'vertical' or 'horizontal'

  histories      RedirectHistory[]
  scanEvents     ScanEvent[]
}

model RedirectHistory {
  id         String    @id @default(cuid())
  businessId String
  business   Business  @relation(fields: [businessId], references: [id], onDelete: Cascade)
  platform   String    // "INSTAGRAM" | "TIKTOK" | "YOUTUBE" (string to avoid enum issues)
  fromUrl    String?
  toUrl      String
  changedAt  DateTime  @default(now())

  @@index([businessId])
  @@index([platform])
}

model ScanEvent {
  id         String    @id @default(cuid())
  createdAt  DateTime  @default(now())
  businessId String
  business   Business  @relation(fields: [businessId], references: [id], onDelete: Cascade)
  platform   String
  userAgent  String?
  ipHash     String?
  referer    String?

  @@index([businessId])
  @@index([platform])
}
